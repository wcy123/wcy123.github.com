<html>
  <head>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Erlang application environment</title>

  <link rel="stylesheet" href="../writ.min.css">
</head>
<body>
<main>
<header>
<h1>Erlang application environment</h1>
<h3 class="date">2015/07/29 13:46:06</h3>
</header>
<article>
<p>我们知道 Erlang 的函数 <code>application:get_env/2</code> 可以返回 app 的配置信息。 例如我们有一个简单的 app 文件，放在 <code>./ebin/myapp.ebin</code> 中。</p>
<p>{% highlight erlang %} {application,myapp, [{description,[]}, {vsn,&quot;1&quot;}, {registered,[]}, {applications,[kernel,stdlib]}, {mod,{myapp_app,[]}}, {env,[{a,1},{b,2}]}, {modules,[myapp_app,myapp_server,myapp_sup]}]}. {% endhighlight %}</p>
<pre><code>bash$ erl -pa ebin
Erlang/OTP 18 [erts-7.0] [source] [64-bit] [async-threads:10] [hipe] [kernel-poll:false]

Eshell V7.0  (abort with ^G)
1&gt; application:load(myapp).
ok
2&gt; application:get_env(myapp,a).
{ok,1}
3&gt; application:get_env(myapp,b).
{ok,2}
4&gt;</code></pre>
<p>除此之外，我们可以通过命令行来修改 app env 。</p>
<pre><code>bash$ erl -pa ebin -myapp a first b second
Erlang/OTP 18 [erts-7.0] [source] [64-bit] [async-threads:10] [hipe] [kernel-poll:false]

Eshell V7.0  (abort with ^G)
1&gt; application:get_env(myapp,a).
undefined
2&gt; application:load(myapp).
ok
3&gt; application:get_env(myapp,a).
{ok,first}
4&gt; application:get_env(myapp,b).
{ok,second}
5&gt;</code></pre>
<p>注意到在 <code>application:load(myapp)</code> 之前，<code>application:get_env(myapp)</code> 都是返回 <code>undefined</code>。</p>
<p>我们也注意到，命令行的配置，覆盖掉了原来 <code>myapp.app</code> 中的默认配置。</p>
<p>还有一种办法可以指定 app 环境，就是利用配置文件。例如，我们写一个配置文件 <code>a.config</code>，如下</p>
<pre><code>[{myapp,
  [{a,one},
   {b,two},
   {c,yes}]}].</code></pre>
<p>然后执行命令</p>
<pre><code>bash$ erl -pa ebin -config a.config
Erlang/OTP 18 [erts-7.0] [source] [64-bit] [async-threads:10] [hipe] [kernel-poll:false]

Eshell V7.0  (abort with ^G)
1&gt; application:get_env(myapp,a).
undefined
2&gt; application:load(myapp).
ok
3&gt; application:get_env(myapp,a).
{ok,one}
4&gt; application:get_env(myapp,b).
{ok,two}
5&gt; application:get_env(myapp,c).
{ok,yes}
6&gt;</code></pre>
<p>可以看到，我们还可以指定新的参数, <code>c</code>。</p>
<p>配置文件 <code>a.config</code> 可以 <code>myapp.app</code> 中的配置，命令行参数 <code>-myapp a yi</code> 可以覆盖配置文件中的设置。</p>
<pre><code>bash$ erl -pa ebin -config a.config -myapp a yi
Erlang/OTP 18 [erts-7.0] [source] [64-bit] [async-threads:10] [hipe] [kernel-poll:false]

Eshell V7.0  (abort with ^G)
1&gt; application:load(myapp).
ok
2&gt; application:get_env(myapp,a).
{ok,yi}
3&gt; application:get_env(myapp,b).
{ok,two}
</code></pre>
</article>
</main>
</body>
</html>
