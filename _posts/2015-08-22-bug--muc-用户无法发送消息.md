---
layout: post
title:  "bug: muc 用户无法发送消息"
date:   2015/08/22 19:47:39
categories:
comments: true
draft: true
---

## 现象，某一个用户无法发送消息，在某一个群中无法发送消息。

todo: 详细描述

出现错误

```
ErrText = <<"Traffic rate limit is exceeded">>,
```

参考源代码 [ErrText = <<"Traffic rate limit is exceeded">>,](https://github.com/easemob/ejabberd.git/blob/f2c2175defbe1a253e56ec37e2f361460e345e65/src/mod_muc_room.erl#L188-#L188)

## log

```
{{39272943,{<<"admin">>,<<"easemob.com">>,<<>>}},
 {1,-1440143462487131},
 {activity,1440143462087100,0,none,none,undefined,undefined},
 nil,
 {{94388844,
   {<<"ppcall#ppcall_101158266">>,<<"easemob.com">>,
    <<"mobile">>}},
  {0,0},
  {activity,1440070079048666,1440142077395191,none,none,
   {xmlel,<<"message">>,
    [{<<"id">>,<<"96658737414013512">>},
     {<<"to">>,<<"ppcall#ppcall_89091123775013296@"...>>},
{<<"type">>,<<"groupchat">>}],
[{xmlel,<<"body">>,[],[{xmlcdata,<<"{"from":"101"...>>}]},
{xmlel,<<"roomtype">>,
[{<<"xmlns">>,<<"easemob:x:ro"...>>},
{<<"type">>,<<"chatroom">>}],
[]}]},
undefined},
{{80817504,
{<<"ppcall#ppcall_104423680">>,<<"easemob.com">>,
<<"mobile">>}},
{0,0},
{activity,1439978350380823,1440101296470696,none,none,
{xmlel,<<"message">>,
[{<<"id">>,<<"96265465805930964">>},
{<<"to">>,<<"ppcall#ppcall_89"...>>},
{<<"type">>,<<"groupchat">>}],
[{xmlel,<<"body">>,[],[{xmlcdata,...}]},
{xmlel,<<"roomtype">>,[{<<...>>,...},{...}],[]}]},
undefined},
nil,nil},
```

分析：

某一用户 Activity 数据出现不一致。

 1. `mod_muc_room:state` 队列为空，
